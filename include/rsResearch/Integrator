#ifndef RSRESEARCH_INTEGRATOR_
#define RSRESEARCH_INTEGRATOR_

#include <vector>

#include <gsl/gsl_errno.h>
#include <gsl/gsl_matrix.h>
#include <gsl/gsl_odeiv2.h>

#include <rs/Vec>

namespace rsResearch {

	// integration struct
	struct Params {
		float w1;
		float w2;
		float a;
		float v;
		float R;
		float phi;
		short num_body;
		short num_legs;
		short num_vars;
		short form;
	};

	// class
	class LIBRSEXPORT Integrator {
		// public functions
		public:
			Integrator(void);
			virtual ~Integrator(void);

			void setup(int(*)(double, const double*, double*, void*), short, short, short, short, float = 0.004);
			void setup(int(*)(double, const double*, double*, void*), struct Params*, float = 0.004);
			const rs::Vec runStep(float);

		// private data
		private:
			double _time;					// time of integration
			float _time_offset;				// initial time offset
			short _body_length;				// length of robot body
			short _form;					// form of robot shape
			short _num_robots;				// number of robots
			short _num_vars;				// number of variables
			std::vector<double> _array;		// array of values from cpg integration
			gsl_odeiv2_driver *_driver;		// driver of cpg integration
			gsl_odeiv2_system _system;		// system of ode equations
	};

} // namespace rsResearch

#endif // RSRESEARCH_INTEGRATOR_

