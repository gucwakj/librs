#ifndef RSSIM_LINKBOT_
#define RSSIM_LINKBOT_

#include <tuple>

#include <rsRobots/Linkbot>
#include <rsSim/ModularRobot>

namespace rsSim {

	// base class
	class Linkbot : virtual public rsRobots::Linkbot, virtual public ModularRobot {
		// public api
		public:
			Linkbot(int);
			virtual ~Linkbot(void);

			virtual int addConnector(int, int, int = rs::RIGHT, double = 0, int = 1, int = -1);
			void addForce(int, const rs::Pos&);
			void addTorque(int, const rs::Pos&);
			virtual void getCoM(double&, double&, double&);
			const rs::Pos getFootForce(void);
			const rs::Pos getFootTorque(void);
			const rs::Vec getJoints(void);
			void moveJointSinusoid(int);		// research
			void setSinusoidGain(double);		// research
			void setSinusoidFrequency(double);		// research
			void setSinusoidPhaseShift(double);		// research

		// inherited functions from ModularRobot class
		protected:
			virtual int build(const rs::Pos&, const rs::Quat&, const rs::Vec&, dBodyID, int, int, int);

		// inherited functions from Robot class
		protected:
			virtual int build(const rs::Pos&, const rs::Quat&, const rs::Vec&, int);
			virtual int buildIndividual(const rs::Pos&, const rs::Quat&, const rs::Vec&);
			virtual double calculate_angle(int);
			virtual void init_params(void);
			virtual void simPreCollisionThread(void);
			virtual void simPostCollisionThread(void);

		// private functions
		private:
			void build_body(const rs::Pos&, const rs::Quat&);
			void build_bridge(Connector&);
			void build_caster(Connector&, int);
			void build_cube(Connector&);
			void build_doublebridge(Connector&);
			void build_face(int, const rs::Pos&, const rs::Quat&);
			void build_faceplate(Connector&);
			void build_gripper(Connector&, int);
			void build_omnidrive(Connector&);
			void build_simple(Connector&);
			void build_wheel(Connector&, double);

		// private variables
		private:
			// research: motor sinusoid motion
			struct Sinusoid {
				double init;			// initial angle
				double gain;			// gain
				double period;			// period
				double phase;			// phase shift
				double start;			// motion start time
				int delay;				// time delay for phase shift
				int run;				// number of motions
			};

			std::vector<Sinusoid> _sine;										// research: sinusoid parameters
			std::vector<std::tuple<dBodyID, double, double, double>> _f;		// research: forces to add to bodies
			std::vector<std::tuple<dBodyID, double, double, double>> _t;		// research: torque to add to bodies
	};

} // namespace rsSim

#endif // RSSIM_LINKBOT_

