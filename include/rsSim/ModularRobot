#ifndef RSSIM_MODULARROBOT_
#define RSSIM_MODULARROBOT_

#include <rsRobots/ModularRobot>
#include <rsSim/Robot>

namespace rsSim {

	// connector struct
	struct Connector {
		dBodyID body;
		dJointFeedback fb;
		double o[3];
		int face, type;
		int d_side, d_type;
		int orientation;
	};

	// typedefs
	typedef std::vector<Connector> ConnectorList;

	// class
	class LIBRSEXPORT ModularRobot : virtual public rsRobots::ModularRobot, virtual public rsSim::Robot {
		// public functions
		public:
			ModularRobot(void);
			virtual ~ModularRobot(void);

			virtual int addConnector(int, int, int = rs::RIGHT, double = 0, int = 1, int = -1) { return 0; };
			virtual int build(const rs::Pos&, const rs::Quat&, const rs::Vec&, dBodyID, int, int, int)  { return 0; };
			const rs::Pos getAttachmentForce(void);
			const rs::Pos getAttachmentTorque(void);
			dBodyID getConnectorBodyID(int);
			int getConnectorOrientation(int);
			ConnectorList& getConnectorList(void);

		// utility functions
		protected:
			int fix_body_to_connector(dBodyID, int, dJointFeedback* = NULL);
			int fix_connector_to_body(int, dBodyID, dJointFeedback* = NULL, int = -1);

		// data members
		protected:
			ConnectorList _conn;				// connectors
			std::vector<dJointFeedback> _fb;	// feedback forces from joints
	};

} // namepsace rsSim

#endif // RSSIM_MODULARROBOT_

