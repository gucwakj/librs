#ifndef RSXML_READER_
#define RSXML_READER_

#include <string>
#include <vector>

#include <rs/Macros>
#include <rsXML/Marker>
#include <rsXML/Obstacle>
#include <rsXML/Robot>
#include <rsXML/BackgroundReader>

namespace tinyxml2 {
	class XMLDocument;
}

namespace rsXML {

	// class
	class LIBRSEXPORT Reader {
		// public functions
		public:
			Reader(const char*, bool = true);
			virtual ~Reader(void);

			void addNewRobot(Robot*);
			void addBackgroundObjects(void);
			std::string getBackgroundImage(short);
			short getLevel(void);
			std::string getName(void);
			Marker* getMarker(short);
			Marker* getNextMarker(short = -1);
			Obstacle* getObstacle(short);
			Obstacle* getNextObstacle(short = -1);
			Robot* getNextRobot(short = -1);
			std::vector<float> getFriction(void);
			std::vector<float> getGrid(void);
			std::vector<float> getRestitution(void);
			std::string getDoc(void);
			short getNumObstacles(void);
			short getNumMarkers(void);
			short getNumRobots(void);
			bool getPause(void);
			bool getRealTime(void);
			bool getTrace(void);
			bool getUnits(void);

		// private functions
		private:
			void load_file(const char*, tinyxml2::XMLDocument*);
			void read_config(tinyxml2::XMLDocument*);
			void read_graphics(tinyxml2::XMLDocument*);
			void read_obstacles(tinyxml2::XMLDocument*);
			void read_sim(tinyxml2::XMLDocument*, bool process);

		// private data
		private:
			bool _pause;						// flag: start in a paused state
			bool _preconfig;					// flag: preconfigured robot shape
			bool _trace;						// flag: trace robot positions
			bool _rt;							// flag: real time motion
			bool _units;						// flag: SI (true) or customary (false)
			int _version;						// version of xml file being read
			std::string _path;					// path of xml file
			std::vector<float> _friction;		// coefficient of friction [body/ground, body/body]
			std::vector<float> _grid;			// grid [tics, hash, minx, maxx, miny, maxy, enabled]
			std::vector<float> _restitution;	// coefficient of restitution [body/ground, body/body]
			std::vector<Obstacle*> _obstacle;	// ground obstacles
			std::vector<Marker*> _marker;		// graphical markers
			std::vector<Robot*> _robot;			// simulation robots
			BackgroundReader *_background;		// background information
	};

	std::string LIBRSEXPORT getDefaultPath(void);

} // namespace rsXML

#endif // RSXML_READER_

